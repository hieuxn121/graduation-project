let logger,models,StatusCodes,uuidv4,getErrorMsg,convertUTCDateToLocalDate;_f41‍.x([["Lessons",()=>Lessons]]);_f41‍.w("npmlog",[["default",["logger"],function(v){logger=v}]]);_f41‍.w("../models",[["default",["models"],function(v){models=v}]]);_f41‍.w("http-status-codes",[["StatusCodes",["StatusCodes"],function(v){StatusCodes=v}]]);_f41‍.w("uuid",[["v4",["uuidv4"],function(v){uuidv4=v}]]);_f41‍.w("../utils/common",[["getErrorMsg",["getErrorMsg"],function(v){getErrorMsg=v}],["convertUTCDateToLocalDate",["convertUTCDateToLocalDate"],function(v){convertUTCDateToLocalDate=v}]]);
const { google } = require('googleapis');
const fs = require('fs');
const path = require('path');







const {
  sequelize,
  Lesson,
} = models;

const CLIENT_ID = '507137610706-153t81svk56souoojrljcvpjo3a9bo0l.apps.googleusercontent.com';
const CLIENT_SECRET = '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';
const REDIRECT_URI = 'https://developers.google.com/oauthplayground';
const REFRESH_TOKEN = '1//044ftbs5l6R8xCgYIARAAGAQSNwF-L9IrMN5VmsIzSBiDFUywNq3APdOYiGOhyIzDXLpQw8ieUYWmS15uGiTIUy9Sa1jSxdKGE1Q';


const oauth2Client = new google.auth.OAuth2(CLIENT_ID, CLIENT_SECRET, REDIRECT_URI);
oauth2Client.setCredentials({ refresh_token: REFRESH_TOKEN });

const drive = google.drive({
  version: 'v3',
  auth: oauth2Client
})

       const Lessons = {
  getListLessons: async ( req, res ) => {
    const {courseId} = req.params;
    try {
        let lessons = await Lesson.findAll({
          where: { course_id: courseId }
        });
      return res.status(StatusCodes.OK).send({
        success: true,
        message: 'Lesson successfully found',
        lessons: lessons,
      });
    } catch (error) {
      logger.error('lesson_find_detail', getErrorMsg(error));
      return res.status(StatusCodes.INTERNAL_SERVER_ERROR).send({
        success: false,
        message: getErrorMsg(error),
      });
    }
  },

  setFilePublic: async (fileId) => {
    try {
      await drive.permissions.create({
        fileId,
        requestBody: {
          role: 'reader',
          type: 'anyone'
        }
      })

      const getUrl = await drive.files.get({
        fileId,
        fields: 'webViewLink, webContentLink'
      })

      return getUrl;
    } catch (error) {
      _f41‍.g.console.error(error);
    }
  },

  getFile: async({ shared }) => {
    console.log('TADA');
  },

  /**
 * Create a folder and prints the folder ID
 * @return{obj} folder Id
 * */
  createFolder :  async () => {
  
    const {GoogleAuth} = require('google-auth-library');
    const {google} = require('googleapis');

    const auth = new GoogleAuth({scopes: 'https://www.googleapis.com/auth/drive'});
    const service = google.drive({version: 'v3', auth});
    const fileMetadata = {
      'title': 'Invoices',
      'parents' : ['1ewSkUOLFQdQN6tOPDYbUYnyBctwjlbjE'],
      'mimeType': 'application/vnd.google-apps.folder',
    };
    try {
      const file = await service.files.create({
        resource: fileMetadata,
        fields: 'id',
      });
      _f41‍.g.console.log('Folder Id:', file.data.id);
      return file.data.id;
    } catch (err) {
      // TODO(developer) - Handle error
      throw err;
    }
  },

  uploadFile: async ({ shared }) => {
    try {
      const createFile = await drive.files.create({
        requestBody: {
          name: "lession1.jpg",
          mimeType: 'application/pdf'
        },
        media: {
          mimeType: 'application/pdf',
          body: fs.createReadStream(path.join(__dirname, '/../lession1.pdf'))
        }
      })
      const fileId = createFile.data.id;
      const getUrl = await Lessons.setFilePublic(fileId);
      const link = `https://drive.google.com/open?id=${fileId}`;
      const lessonId = 'ccbe31f2-28db-4e5a-b207-633571756f8f';
      const courseId = 'c69e65eb-b953-4b71-802c-5d03b9edac64'

      const result = await Lesson.update({ pdf_file_link: link }, {
        where: {lesson_id: lessonId, course_id: courseId}
      })
      if (result === 1) {
        return res.status(StatusCodes.OK).send({
          success: true,
          message: 'Lesson successfully update link',
        });
      }
    } catch (error) {
      _f41‍.g.console.error(error);
    }
  },
  deleteFile: async (fileId) => {
    try {
      const deleteFile = await drive.files.delete({
        fileId: fileId
      })
      _f41‍.g.console.log(deleteFile.data, deleteFile.status)
    } catch (error) {
      _f41‍.g.console.error(error);
    }
  }
}